<!DOCTYPE html>
<html>
  <head>
    <meta id="view-meta" name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/lightbox.min.js"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
       showProcessingMessages: false,
       messageStyle: "none",
       "HTML-CSS": {
        imageFont: null,
        linebreaks: { 
         automatic: true,
         width: "container",
        }, 
       },
       SVG: {
        linebreaks: { 
         automatic: true,
         width: "container",
        }, 
       },
      });
    </script>
    <script src="/js/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="/css/naked.css" type="text/css" rel="stylesheet"/>
    <link href="/css/lightbox.css" type="text/css" rel="stylesheet"/>
    <script>
      /*
      $(document).ready( function() {
      
       var $label = $(".dbg-width-label");
       var $body = $("body");
       var $pageFrame = $("#page-frame");
       var $contentFrame = $("#content-frame");
       var $meta = $("#view-meta");
       var $artFrame = $("#article-frame");
       var $contentBody = $(".content-body");
       var sizeCheck = function() {
        var bodSize = $body.width();
        var pfSize = $pageFrame.width();
        var cfSize = $contentFrame.width();
        var vSize = $meta.attr("content");
        var labelTxt = "B: " + bodSize + "  p: " + pfSize + "  c: " + cfSize + "<br/>";
        var afSize = $artFrame.width();
        var cbSize = $contentBody.width();
        var label2 = "A: " + afSize + "  Cb: " + cbSize;
        
        $label.html(labelTxt + label2);
       }
       
       setInterval(sizeCheck, 2000);
       
       });
       */
    </script>
    <title>scivey | Image Generation with SVG Templates, Part I</title>
    <script src="/js/app/article.js"></script>
  </head>
  <body>
    <div id="page-frame">
      <div id="content-frame">
        <div class="article-page-top"><a href="/articles" class="si-icon-link"><span class="si-icon si-icon-md iconic arrow_left"></span></a></div>
        <div id="article-frame">
          <div id="article-header"><span class="article-header-text">
              <h3>Image Generation with SVG Templates, Part I
              </h3></span><span class="dbg-width-label"></span>
            <hr>
          </div>
          <div id="article-body" class="content-body"><div id="p_outer_wrapper"><p>SVG, the W3C-defined web standard for describing vector graphics, has the drawbacks and benefits typical of XML formats: its verbosity makes it inefficient to author by hand, but its standardized syntax means that parsers and related tools are available for almost all languages and platforms.</p>
<p>It&#39;s also widely supported: most desktop and mobile browsers can render SVG, and many graphic design programs directly edit or export SVG. (E.g. InkScape, Adobe Illustrator.)</p>
<p>Being usable in native form, easily convertable to PNG and other raster formats, and simple to edit with XML and text-based tools, SVG is an effective raw material for graphics generation.  It can be thought of as a backend for the visual description of data, usable as-is and easy to process further.</p>
<p>SVG&#39;s verbosity still needs to be managed, but we already have many tools for handling that problem in the domain of HTML.  These include a large number of templating engines, some of which are more useful for this purpose than others.</p>
<h5>Handlebars</h5>
<p>In this article we&#39;ll combine the Handlebars templating language with SVG fragments to generate graphical representations of JSON-format data.  Handlebars makes an ideal engine for this use because its lightweight/semantic syntax within templates has a similar declarative feel to pure XML documents, while its custom block and expression helpers make it easy to apply reusable imperative code to sections of the template.  This is especially useful in SVG, as most operations will involve loops and a small set of coordinate transformations like scaling and offsetting.</p>
<p>With helpers handling these details, complete documents can be generated by iterating over very simple fragments of SVG.  A set of coordinates in the range of {0 &lt;= x &lt;= 100; 0 &lt;= y &lt;= 100} can be plotted like so:</p>
<pre><code class="lang-xml"><span class="support tag"><span class="support tag">&lt;?</span><span class="support tag-name">xml</span></span> <span class="support attribute">version</span>=&quot;1.0&quot;<span class="support tag close">?&gt;</span>

<span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">svg</span></span> <span class="support attribute">width</span>=&quot;100&quot; <span class="support attribute">height</span>=&quot;100&quot; <span class="support attribute">version</span>=&quot;1.1&quot;
    <span class="support attribute">xmlns:svg</span>=&quot;http://www.w3.org/2000/svg&quot;
    <span class="support attribute">xmlns</span>=&quot;http://www.w3.org/2000/svg&quot;
    <span class="support attribute">xmlns:xlink</span>=&quot;http://www.w3.org/1999/xlink&quot;<span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">rect</span></span> <span class="support attribute">x</span>=&quot;0&quot; <span class="support attribute">y</span>=&quot;0&quot; <span class="support attribute">width</span>=&quot;100&quot; <span class="support attribute">height</span>=&quot;100&quot;
            <span class="support attribute">stroke</span>=&quot;#333333&quot; <span class="support attribute">stroke-width</span>=&quot;2&quot; <span class="support attribute">fill</span>=&quot;none&quot;<span class="support tag close">/&gt;</span>
        {{#each points}}
                  <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">circle</span></span> <span class="support attribute">cx</span>=&quot;{{x}}&quot; <span class="support attribute">cy</span>=&quot;{{sub 100 y}}&quot;
                      <span class="support attribute">r</span>=&quot;3&quot; <span class="support attribute">stroke-width</span>=&quot;2&quot; <span class="support attribute">stroke</span>=&quot;#000000&quot;
                      <span class="support attribute">fill</span>=&quot;#00ff00&quot;<span class="support tag close">/&gt;</span>
        {{/each}}

    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">svg</span></span><span class="support tag close">&gt;</span></code></pre>
<p>This template does most of its work between the <code>{{#each points}}</code> and <code>{{/each}}</code> delimiters, which together represent a loop over an array stored in the <code>points</code> top-level attribute of a Javascript object.  It expects each of these points to be an object with <code>x</code> and <code>y</code> properties, which are mapped to the <code>cx</code> and <code>cy</code> attributes of the <code>&lt;circle&gt;</code> element contained in the loop.</p>
<p>Visually, the template takes this JSON:</p>
<pre><code class="lang-json">{&quot;points&quot;:
    [
        {&quot;x&quot;:<span class="constant numeric">50</span>,&quot;y&quot;:<span class="constant numeric">15</span>},
        {&quot;x&quot;:<span class="constant numeric">20</span>,&quot;y&quot;:<span class="constant numeric">50</span>},
        {&quot;x&quot;:<span class="constant numeric">70</span>,&quot;y&quot;:<span class="constant numeric">30</span>},
        {&quot;x&quot;:<span class="constant numeric">15</span>,&quot;y&quot;:<span class="constant numeric">80</span>},
        {&quot;x&quot;:<span class="constant numeric">80</span>,&quot;y&quot;:<span class="constant numeric">20</span>},
        {&quot;x&quot;:<span class="constant numeric">60</span>,&quot;y&quot;:<span class="constant numeric">70</span>}
    ]
}</code></pre>
<p>And this expression helper for subtraction:</p>
<pre><code class="lang-javascript">Handlebars.<span class="function call">registerHelper</span>(&quot;sub&quot;, <span class="keyword">function</span>(x, y) {
    <span class="keyword">return</span> x <span class="keyword operator">-</span> y;
});</code></pre>
<p>And produces the following image:</p>
<div class="block-diagram block-diagram-pic fig"><section class="block-diagram-title"><h5>circles.svg</h5></section> <a data-lightbox="img/fig/circles1.svg" href="img/fig/circles1.svg" title="First attempt."><img class="block-fig-image" src="img/fig/circles1.svg"></a> <section class="block-diagram-caption"><p>First attempt.</p></section></div>
<p>That wasn&#39;t a total failure, but the output is pretty small.  It could be enlarged by scaling all of the point values before passing them into the template function:</p>
<pre><code class="lang-javascript">_ <span class="keyword operator">=</span> <span class="function call">require</span>(&quot;underscore&quot;);

transformedPoints <span class="keyword operator">=</span> _.<span class="function call">map</span>(data.points, <span class="keyword">function</span>(onePoint) {
    pt <span class="keyword operator">=</span> {}
    pt.x <span class="keyword operator">=</span> onePoint.x <span class="keyword operator">*</span> <span class="constant numeric">3</span>;
    pt.y <span class="keyword operator">=</span> onePoint.y <span class="keyword operator">*</span> <span class="constant numeric">3</span>;
    <span class="keyword">return</span> pt;
});</code></pre>
<p>Scaling each point&#39;s <code>x</code> and <code>y</code> value by three and increasing the root <code>&lt;svg&gt;</code> element&#39;s <code>height</code> and <code>width</code> each to 300 yields a 3x-magnified version of the same image:</p>
<div class="block-diagram block-diagram-pic fig"><section class="block-diagram-title"><h5>circles1_scaled.svg</h5></section> <a data-lightbox="img/fig/circles1_scaled.svg" href="img/fig/circles1_scaled.svg" title="Second attempt."><img class="block-fig-image" src="img/fig/circles1_scaled.svg"></a> <section class="block-diagram-caption"><p>Second attempt.</p></section></div>
<p>Once again, this works... sort of.  There are some obvious problems, the first being that the <code>height</code> and <code>width</code> of the document have to be manually adjusted.  So do those of the framing <code>rect</code>.  The radius of the template <code>circle</code> element also hasn&#39;t been scaled, making the points less visible compared to those in the first version.</p>
<p>We could scale the circles by hand too, but the number of manual edits is adding up quickly.  That&#39;s exactly what templating is meant to avoid.  Fortunately, there&#39;s a better way.</p>
<h5>The <code>viewBox</code> Attribute</h5>
<p>SVG has two features which can be combined to sidestep this problem.  The first: reusable elements can be defined inside of the <code>&lt;defs&gt;</code> section in the top of the document, then inserted anywhere else via XLink-style links to their <code>id</code> attributes.  This takes the form of a <code>&lt;use&gt;</code> element with an <code>xlink:href=&quot;#element-id&quot;</code> attribute.</p>
<p>The second feature: in the same way that a <code>&lt;rect&gt;</code> can be assigned a given height and width, a <code>&lt;use&gt;</code> element linking to a predefined document node can specify the position and dimensions of its output, regardless of the attributes assigned to the targed element in <code>&lt;defs&gt;</code>.  This means that values can be mapped to a convenient coordinate space within a predefined element, and then scaled by including the parent element within another coordinate space.  (With some complications covered later.)</p>
<p>A node defined in <code>&lt;defs&gt;</code> could be a shape in itself (e.g. <code>&lt;rect&gt;</code>) or a grouping element like <code>&lt;symbol&gt;</code>, which can include any number of sub-elements.  A simple example of a defined <code>&lt;symbol&gt;</code>, containing two child elements:</p>
<pre><code class="lang-xml"><span class="support tag"><span class="support tag">&lt;?</span><span class="support tag-name">xml</span></span> <span class="support attribute">version</span>=&quot;1.0&quot;<span class="support tag close">?&gt;</span>

<span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">svg</span></span> <span class="support attribute">width</span>=&quot;300&quot; <span class="support attribute">height</span>=&quot;300&quot; <span class="support attribute">version</span>=&quot;1.1&quot; 
    <span class="support attribute">xmlns:svg</span>=&quot;http://www.w3.org/2000/svg&quot; 
    <span class="support attribute">xmlns</span>=&quot;http://www.w3.org/2000/svg&quot; 
    <span class="support attribute">xmlns:xlink</span>=&quot;http://www.w3.org/1999/xlink&quot;<span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">defs</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">symbol</span></span> <span class="support attribute">id</span>=&quot;rect-and-circle&quot; <span class="support attribute">viewBox</span>=&quot;0 0 100 100&quot;<span class="support tag close">&gt;</span>
            <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">rect</span></span> <span class="support attribute">x</span>=&quot;5&quot; <span class="support attribute">y</span>=&quot;5&quot; <span class="support attribute">height</span>=&quot;40&quot; <span class="support attribute">width</span>=&quot;40&quot; 
                <span class="support attribute">stroke</span>=&quot;#333&quot; <span class="support attribute">stroke-width</span>=&quot;2&quot; <span class="support attribute">fill</span>=&quot;#00ff00&quot;<span class="support tag close">/&gt;</span>
            <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">circle</span></span> <span class="support attribute">cx</span>=&quot;70&quot; <span class="support attribute">cy</span>=&quot;70&quot; <span class="support attribute">r</span>=&quot;20&quot; 
                <span class="support attribute">stroke</span>=&quot;#333&quot; <span class="support attribute">stroke-width</span>=&quot;2&quot; <span class="support attribute">fill</span>=&quot;#00ff00&quot;<span class="support tag close">/&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">symbol</span></span><span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">defs</span></span><span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">use</span></span> <span class="support attribute">xlink:href</span>=&quot;#rect-and-circle&quot; <span class="support attribute">x</span>=&quot;0&quot; <span class="support attribute">y</span>=&quot;0&quot; 
            <span class="support attribute">height</span>=&quot;300&quot; <span class="support attribute">width</span>=&quot;300&quot;<span class="support tag close">/&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">svg</span></span><span class="support tag close">&gt;</span></code></pre>
<p>Rendered:</p>
<div class="block-diagram block-diagram-pic fig"><section class="block-diagram-title"><h5>simple_symbol.svg</h5></section> <a data-lightbox="img/fig/simple_symbol.svg" href="img/fig/simple_symbol.svg" title="Simple example of `symbol` tag"><img class="block-fig-image" src="img/fig/simple_symbol.svg"></a> <section class="block-diagram-caption"><p>Simple example of `symbol` tag</p></section></div>
<p>Note that the dimensions of the circle and square are defined within a 100-by-100 coordinate system, given by the <code>viewBox</code> attribute of their containing <code>&lt;symbol&gt;</code> element.  (<code>viewBox</code> takes a string of the form <code>&quot;x1 y1 x2 y2&quot;</code>, i.e. <code>&quot;xMin yMin xMax yMax&quot;</code>, which in this case is <code>viewBox=&quot;0 0 100 100&quot;</code>.)</p>
<p><code>#rect-and-circle</code> is displayed at 3x-scale because the <code>&lt;use&gt;</code> tag referencing it has <code>height</code> and <code>width</code> values of 300.  This is a simple trick, but saves us from many repetitive scaling and offsetting transformations on data passed in to the template.  The same coordinate transformations take place under the hood, but they&#39;re performed by the rendering engine and out of our concern.</p>
<p><code>&lt;symbol&gt;</code> is often used to define complex composite shapes, but it&#39;s also generally useful for any kind of coordinate transformation.  This makes it well suited to point plotting.  Instead of the <code>_.map</code> operation earlier, let&#39;s scale our data set using the <code>defs/symbol</code> approach:</p>
<pre><code class="lang-xml"><span class="support tag"><span class="support tag">&lt;?</span><span class="support tag-name">xml</span></span> <span class="support attribute">version</span>=&quot;1.0&quot;<span class="support tag close">?&gt;</span>

<span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">svg</span></span> <span class="support attribute">width</span>=&quot;300&quot; <span class="support attribute">height</span>=&quot;300&quot; <span class="support attribute">version</span>=&quot;1.1&quot; 
    <span class="support attribute">xmlns:svg</span>=&quot;http://www.w3.org/2000/svg&quot; 
    <span class="support attribute">xmlns</span>=&quot;http://www.w3.org/2000/svg&quot; 
    <span class="support attribute">xmlns:xlink</span>=&quot;http://www.w3.org/1999/xlink&quot;<span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">defs</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">symbol</span></span> <span class="support attribute">id</span>=&quot;plotted-points&quot; <span class="support attribute">viewBox</span>=&quot;0 0 100 100&quot;<span class="support tag close">&gt;</span>
            {{#each points}}
                  <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">circle</span></span> <span class="support attribute">cx</span>=&quot;{{x}}&quot; <span class="support attribute">cy</span>=&quot;{{sub 100 y}}&quot;
                      <span class="support attribute">r</span>=&quot;3&quot; <span class="support attribute">stroke-width</span>=&quot;1&quot; <span class="support attribute">stroke</span>=&quot;#333333&quot; 
                      <span class="support attribute">fill</span>=&quot;#00ff00&quot;<span class="support tag close">/&gt;</span>
            {{/each}}
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">symbol</span></span><span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">defs</span></span><span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">rect</span></span> <span class="support attribute">x</span>=&quot;0&quot; <span class="support attribute">y</span>=&quot;0&quot; <span class="support attribute">width</span>=&quot;300&quot; <span class="support attribute">height</span>=&quot;300&quot;
            <span class="support attribute">stroke</span>=&quot;#333333&quot; <span class="support attribute">stroke-width</span>=&quot;2&quot;
            <span class="support attribute">fill</span>=&quot;none&quot;<span class="support tag close">/&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">use</span></span> <span class="support attribute">xlink:href</span>=&quot;#plotted-points&quot;
        <span class="support attribute">x</span>=&quot;0&quot; <span class="support attribute">y</span>=&quot;0&quot; <span class="support attribute">width</span>=&quot;300&quot; <span class="support attribute">height</span>=&quot;300&quot;<span class="support tag close">/&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">svg</span></span><span class="support tag close">&gt;</span></code></pre>
<div class="block-diagram block-diagram-pic fig"><section class="block-diagram-title"><h5>circles2.svg</h5></section> <a data-lightbox="img/fig/circles2.svg" href="img/fig/circles2.svg" title="Same visual result as before, but much simpler code.  There" s="" no="" need="" for="" coordinate="" transformation="" before="" passing="" data="" to="" the="" template.'=""><img class="block-fig-image" src="img/fig/circles2.svg"></a> <section class="block-diagram-caption"><p>Same visual result as before, but much simpler code.  There's no need for coordinate transformation before passing data to the template.</p></section></div>
<p>The same approach can be used to offset a given diagram, making space for other graphical elements and for chart or axis labels.  First give the root <code>&lt;svg&gt;</code> element a larger <code>height</code> and <code>width</code> than the target size of the plotted data, then give the <code>&lt;use&gt;</code> tag <code>x</code> and <code>y</code> attributes according to the offset:</p>
<pre><code class="lang-xml">
<span class="support tag"><span class="support tag">&lt;?</span><span class="support tag-name">xml</span></span> <span class="support attribute">version</span>=&quot;1.0&quot;<span class="support tag close">?&gt;</span>

<span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">svg</span></span> <span class="support attribute">width</span>=&quot;450&quot; <span class="support attribute">height</span>=&quot;450&quot; <span class="support attribute">version</span>=&quot;1.1&quot;
    <span class="support attribute">xmlns:svg</span>=&quot;http://www.w3.org/2000/svg&quot;
    <span class="support attribute">xmlns</span>=&quot;http://www.w3.org/2000/svg&quot;
    <span class="support attribute">xmlns:xlink</span>=&quot;http://www.w3.org/1999/xlink&quot;<span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">defs</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">symbol</span></span> <span class="support attribute">id</span>=&quot;plotted-points&quot;
            <span class="support attribute">viewBox</span>=&quot;0 0 100 100&quot;<span class="support tag close">&gt;</span>
            {{#each points}}
                  <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">circle</span></span> <span class="support attribute">cx</span>=&quot;{{x}}&quot; <span class="support attribute">cy</span>=&quot;{{sub 100 y}}&quot;
                      <span class="support attribute">r</span>=&quot;3&quot; <span class="support attribute">stroke-width</span>=&quot;1&quot;
                      <span class="support attribute">stroke</span>=&quot;#333333&quot; <span class="support attribute">fill</span>=&quot;#00ff00&quot;<span class="support tag close">/&gt;</span>
            {{/each}}
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">symbol</span></span><span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">defs</span></span><span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">rect</span></span> <span class="support attribute">x</span>=&quot;0&quot; <span class="support attribute">y</span>=&quot;0&quot; <span class="support attribute">width</span>=&quot;450&quot; <span class="support attribute">height</span>=&quot;450&quot;
            <span class="support attribute">stroke</span>=&quot;#333333&quot; <span class="support attribute">stroke-width</span>=&quot;2&quot; <span class="support attribute">fill</span>=&quot;none&quot;<span class="support tag close">/&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">rect</span></span> <span class="support attribute">x</span>=&quot;75&quot; <span class="support attribute">y</span>=&quot;75&quot; <span class="support attribute">width</span>=&quot;300&quot; <span class="support attribute">height</span>=&quot;300&quot;
            <span class="support attribute">stroke</span>=&quot;#333333&quot; <span class="support attribute">stroke-width</span>=&quot;2&quot; <span class="support attribute">fill</span>=&quot;none&quot;<span class="support tag close">/&gt;</span>

        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">use</span></span> <span class="support attribute">xlink:href</span>=&quot;#plotted-points&quot; <span class="support attribute">x</span>=&quot;75&quot; <span class="support attribute">y</span>=&quot;75&quot;
            <span class="support attribute">width</span>=&quot;300&quot; <span class="support attribute">height</span>=&quot;300&quot;<span class="support tag close">/&gt;</span>

        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">text</span></span> <span class="support attribute">x</span>=&quot;225&quot; <span class="support attribute">y</span>=&quot;35&quot; <span class="support attribute">text-anchor</span>=&quot;middle&quot;<span class="support tag close">&gt;</span>Top<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">text</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">text</span></span> <span class="support attribute">x</span>=&quot;225&quot; <span class="support attribute">y</span>=&quot;415&quot; <span class="support attribute">text-anchor</span>=&quot;middle&quot;<span class="support tag close">&gt;</span>Bottom<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">text</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">text</span></span> <span class="support attribute">x</span>=&quot;25&quot; <span class="support attribute">y</span>=&quot;225&quot; <span class="support attribute">text-anchor</span>=&quot;middle&quot;<span class="support tag close">&gt;</span>L<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">text</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">text</span></span> <span class="support attribute">x</span>=&quot;425&quot; <span class="support attribute">y</span>=&quot;225&quot; <span class="support attribute">text-anchor</span>=&quot;middle&quot;<span class="support tag close">&gt;</span>R<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">text</span></span><span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">svg</span></span><span class="support tag close">&gt;</span></code></pre>
<div class="block-diagram block-diagram-pic fig"><section class="block-diagram-title"><h5>circles2_offset.svg</h5></section> <a data-lightbox="img/fig/circles2_offset_circlePoints.svg" href="img/fig/circles2_offset_circlePoints.svg" title="The `symbol` element can be used for both scaling and offsetting coordinates."><img class="block-fig-image" src="img/fig/circles2_offset_circlePoints.svg"></a> <section class="block-diagram-caption"><p>The `symbol` element can be used for both scaling and offsetting coordinates.</p></section></div>
<p>This illustrates a major advantage of plotting data within a <code>defs/symbol</code> element: positions of other elements in the final document can be specified very precisely and still be valid for a variety of rendered inputs.  Changing the data itself won&#39;t affect its visual relationship with the rest of the document, as this is determined by the linking <code>&lt;use&gt;</code> element and not by the elements directly representing the data.</p>
<p>To make this clear, let&#39;s redefine our JSON data set to include <code>min</code> and <code>max</code> values for each of the X and Y axes.  These values will be inserted into the symbol&#39;s <code>viewBox</code> attribute instead of the hard-coded <code>0 0 100 100</code> value used earlier.</p>
<pre><code class="lang-json">{
    &quot;xAxis&quot;: {
        &quot;min&quot;: <span class="constant numeric">0</span>,
        &quot;max&quot;: <span class="constant numeric">100</span>
        },
    &quot;yAxis&quot;: {
        &quot;min&quot;: <span class="constant numeric">0</span>,
        &quot;max&quot;: <span class="constant numeric">100</span>
    },
    &quot;points&quot;:
    [
        {&quot;x&quot;:<span class="constant numeric">50</span>,&quot;y&quot;:<span class="constant numeric">15</span>},
        {&quot;x&quot;:<span class="constant numeric">20</span>,&quot;y&quot;:<span class="constant numeric">50</span>},
        {&quot;x&quot;:<span class="constant numeric">70</span>,&quot;y&quot;:<span class="constant numeric">30</span>},
        {&quot;x&quot;:<span class="constant numeric">15</span>,&quot;y&quot;:<span class="constant numeric">80</span>},
        {&quot;x&quot;:<span class="constant numeric">80</span>,&quot;y&quot;:<span class="constant numeric">20</span>},
        {&quot;x&quot;:<span class="constant numeric">60</span>,&quot;y&quot;:<span class="constant numeric">70</span>}
    ]
}</code></pre>
<p>The new template inserts the <code>xAxis.min</code>, <code>xAxis.max</code>, <code>yAxis.min</code> and <code>yAxis.max</code> values into <code>viewBox</code>:</p>
<pre><code class="lang-xml"><span class="support tag"><span class="support tag">&lt;?</span><span class="support tag-name">xml</span></span> <span class="support attribute">version</span>=&quot;1.0&quot;<span class="support tag close">?&gt;</span>

<span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">svg</span></span> <span class="support attribute">width</span>=&quot;450&quot; <span class="support attribute">height</span>=&quot;450&quot; <span class="support attribute">version</span>=&quot;1.1&quot;
    <span class="support attribute">xmlns:svg</span>=&quot;http://www.w3.org/2000/svg&quot;
    <span class="support attribute">xmlns</span>=&quot;http://www.w3.org/2000/svg&quot;
    <span class="support attribute">xmlns:xlink</span>=&quot;http://www.w3.org/1999/xlink&quot;<span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">defs</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">symbol</span></span> <span class="support attribute">id</span>=&quot;one-point&quot; <span class="support attribute">viewBox</span>=&quot;0 0 20 20&quot; 
            <span class="support attribute">preserveAspectRatio</span>=&quot;xMidYMid meet&quot;<span class="support tag close">&gt;</span>
            <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">circle</span></span> <span class="support attribute">cx</span>=&quot;10&quot; <span class="support attribute">cy</span>=&quot;10&quot; <span class="support attribute">r</span>=&quot;5&quot; 
                <span class="support attribute">stroke-width</span>=&quot;1&quot; <span class="support attribute">stroke</span>=&quot;#333333&quot;
                <span class="support attribute">fill</span>=&quot;#00ff00&quot; <span class="support tag close">/&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">symbol</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">symbol</span></span> <span class="support attribute">id</span>=&quot;plotted-points&quot; 
            <span class="support attribute">viewBox</span>=&quot;{{xAxis.min}} {{yAxis.min}} 
                    {{xAxis.max}} {{yAxis.max}}&quot; 
            <span class="support attribute">preserveAspectRatio</span>=&quot;none&quot; <span class="support tag close">&gt;</span>
            <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">rect</span></span> <span class="support attribute">x</span>=&quot;0&quot; <span class="support attribute">y</span>=&quot;0&quot; <span class="support attribute">width</span>=&quot;{{xAxis.max}}&quot; 
                <span class="support attribute">height</span>=&quot;{{yAxis.max}}&quot; <span class="support attribute">fill</span>=&quot;none&quot; 
                <span class="support attribute">stroke</span>=&quot;#333333&quot; <span class="support attribute">stroke-width</span>=&quot;1&quot;<span class="support tag close">/&gt;</span>
            {{#each points}}
                 <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">use</span></span> <span class="support attribute">xlink:href</span>=&quot;#one-point&quot; <span class="support attribute">x</span>=&quot;{{x}}&quot; 
                     <span class="support attribute">y</span>=&quot;{{sub ../yAxis.max y}}&quot;
                     <span class="support attribute">height</span>=&quot;10&quot; <span class="support attribute">width</span>=&quot;10&quot;<span class="support tag close">/&gt;</span>
            {{/each}}
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">symbol</span></span><span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">defs</span></span><span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">rect</span></span> <span class="support attribute">x</span>=&quot;0&quot; <span class="support attribute">y</span>=&quot;0&quot; <span class="support attribute">width</span>=&quot;450&quot; <span class="support attribute">height</span>=&quot;450&quot;
            <span class="support attribute">stroke</span>=&quot;#333333&quot; <span class="support attribute">stroke-width</span>=&quot;2&quot;
            <span class="support attribute">fill</span>=&quot;none&quot;<span class="support tag close">/&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">text</span></span> <span class="support attribute">x</span>=&quot;225&quot; <span class="support attribute">y</span>=&quot;15&quot; <span class="support attribute">text-anchor</span>=&quot;middle&quot;<span class="support tag close">&gt;</span>
            Plotted Points
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">text</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">use</span></span> <span class="support attribute">xlink:href</span>=&quot;#plotted-points&quot; <span class="support attribute">x</span>=&quot;25&quot;
            <span class="support attribute">y</span>=&quot;25&quot; <span class="support attribute">width</span>=&quot;400&quot; <span class="support attribute">height</span>=&quot;400&quot;<span class="support tag close">/&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">svg</span></span><span class="support tag close">&gt;</span></code></pre>
<p>Feeding the modified JSON into this template yields the following image:</p>
<div class="block-diagram block-diagram-pic fig"><section class="block-diagram-title"><h5>circles3.svg</h5></section> <a data-lightbox="img/fig/circles3.svg" href="img/fig/circles3.svg" title="Points plotted according to specified max and min for each axis."><img class="block-fig-image" src="img/fig/circles3.svg"></a> <section class="block-diagram-caption"><p>Points plotted according to specified max and min for each axis.</p></section></div>
<p>The resulting image looks the same as the previous template&#39;s output, but is much easier to modify by manipulating the <code>xAxis.max</code> and <code>yAxis.max</code> properties of the data set&#39;s container object.  Scaling these values to 150 each, we get the following image.  Notice that we don&#39;t have to recalculate the positions of the labels or of the box containing the points.</p>
<div class="block-diagram block-diagram-pic fig"><section class="block-diagram-title"><h5>circles3_scaled.svg</h5></section> <a data-lightbox="img/fig/circles3_scaled.svg" href="img/fig/circles3_scaled.svg" title="The points easily scale, with no changes to labels or other elements."><img class="block-fig-image" src="img/fig/circles3_scaled.svg"></a> <section class="block-diagram-caption"><p>The points easily scale, with no changes to labels or other elements.</p></section></div>
<p>Looks good so far, but there are some limitations to this approach.  Look at the same figure rendered with <code>yAxis.max=150</code> and <code>xAxis.max=100</code>:</p>
<div class="block-diagram block-diagram-pic fig"><section class="block-diagram-title"><h5>circles3_circlePoints2_scaled_uneven.svg</h5></section> <a data-lightbox="img/fig/circles3_circlePoints2_scaled_uneven.svg" href="img/fig/circles3_circlePoints2_scaled_uneven.svg" title="The group of plotted points doesn" t="" automatically="" stretch="" to="" fill="" the="" dimensions="" specified="" by="" `use`="" tag.'=""><img class="block-fig-image" src="img/fig/circles3_circlePoints2_scaled_uneven.svg"></a> <section class="block-diagram-caption"><p>The group of plotted points doesn't automatically stretch to fill the dimensions specified by the `use` tag.</p></section></div>
<p>Although the <code>&lt;use xlink:href=&quot;#plotted-points&quot; ... /&gt;</code> tag specifies <code>width</code> and <code>height</code> attributes, SVG&#39;s default scaling preserves the aspect ratio of the underlying symbol.  The scaling strategy can be changed with the <code>preserveAspectRatio</code> attribute on <code>symbol</code>:</p>
<pre><code class="lang-xml"><span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">symbol</span></span> <span class="support attribute">id</span>=&quot;plotted-points&quot; <span class="support attribute">viewBox</span>=&quot;{{xAxis.min}} {{yAxis.min}} {{xAxis.max}} {{yAxis.max}}&quot; <span class="support attribute">preserveAspectRatio</span>=&quot;none&quot; <span class="support tag close">&gt;</span>
        <span class="comment html">&lt;!-- child elements --&gt;</span>
<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">symbol</span></span><span class="support tag close">&gt;</span></code></pre>
<p>However, the output shows that there&#39;s still a problem:</p>
<div class="block-diagram block-diagram-pic fig"><section class="block-diagram-title"><h5>`#plotted-points` stretched out to fill the `use` tag.</h5></section> <a data-lightbox="img/fig/circles3_stretched_circlePoints2_scaled_uneven.svg" href="img/fig/circles3_stretched_circlePoints2_scaled_uneven.svg" title="Stretching the symbol with `preserveAspectRatio=&quot;none&quot;` distorts the child elements used to represent point coordinates."><img class="block-fig-image" src="img/fig/circles3_stretched_circlePoints2_scaled_uneven.svg"></a> <section class="block-diagram-caption"><p>Stretching the symbol with `preserveAspectRatio="none"` distorts the child elements used to represent point coordinates.</p></section></div>
<p>The circular points have turned into ovals, because the <code>preserveAspectRatio</code> attribute is cascaded onto all of an element&#39;s children.  Adding a different <code>preserveAspectRatio</code> attribute to the child elements has no effect.  Using SVG tags alone, there doesn&#39;t appear to be any solution.</p>
<h5>Block Helpers</h5>
<p>This problem can be solved by defining a Handlebars block helper, <code>scaleBox</code>, which maps points&#39; <code>x</code> and <code>y</code> values between two sets of <code>viewBox</code> coordinates.  It does this by providing <code>@xScale</code> and <code>@yScale</code> functions to all child expressions, which can be called with the <code>apply</code> expression defined below:</p>
<pre><code class="lang-javascript">
Handlebars.<span class="function call">registerHelper</span>(&quot;apply&quot;, <span class="keyword">function</span>(fn, param) {
    <span class="keyword">return</span> <span class="function call">fn</span>(param);
});</code></pre>
<p><code>apply</code> is used with the syntax <code>{{apply FN PARAM}}</code>, and returns the result of applying <code>FN</code> to <code>PARAM</code>.  The <code>scaleBox</code> is more complicated, so it will be helpful to see it in action before going through the code.</p>
<p>The template below returns plain text, not SVG.  It accepts the same set of points with <code>x</code> and <code>y</code> properties, outputting a string with the format &quot;originalX originalY  -&gt;  transformedX transformedY&quot;.  In this particular template, points from the space {0 &lt;= x &lt;= 100; 0 &lt;= y &lt;= 100} are mapped into the space {0 &lt;= x &lt;= 100; 100 &lt;= y &lt;= 250}.</p>
<pre><code class="lang-xml">{{#scaleBox <span class="support attribute">0</span> <span class="support attribute">0</span> <span class="support attribute">100</span> <span class="support attribute">100</span> <span class="support attribute">0</span> <span class="support attribute">100</span> <span class="support attribute">100</span> 250}}
    {{#each points}}
        {{x}} {{y}}     -<span class="support tag close">&gt;</span>        {{apply @xScale x}} {{apply @yScale y}}
    {{/each}}
{{/scaleBox}}</code></pre>
<p>Output:</p>
<pre><code class="lang-xml">        <span class="support attribute">50</span> <span class="support attribute">15</span>     -<span class="support tag close">&gt;</span>        <span class="support attribute">50</span> 122.5

        <span class="support attribute">20</span> <span class="support attribute">50</span>     -<span class="support tag close">&gt;</span>        <span class="support attribute">20</span> <span class="support attribute">175</span>

        <span class="support attribute">70</span> <span class="support attribute">30</span>     -<span class="support tag close">&gt;</span>        <span class="support attribute">70</span> <span class="support attribute">145</span>

        <span class="support attribute">15</span> <span class="support attribute">80</span>     -<span class="support tag close">&gt;</span>        <span class="support attribute">15</span> <span class="support attribute">220</span>

        <span class="support attribute">80</span> <span class="support attribute">20</span>     -<span class="support tag close">&gt;</span>        <span class="support attribute">80</span> <span class="support attribute">130</span>

        <span class="support attribute">60</span> <span class="support attribute">70</span>     -<span class="support tag close">&gt;</span>        <span class="support attribute">60</span> 205</code></pre>
<p><code>scaleBox</code> also supplies a convenience function for y-axis transformation, <code>@yScaleInvert</code>, which applies <code>@yScale</code> and then subtracts the result from the destination space&#39;s maximum <code>y</code> value.  This &quot;inverts&quot; <code>y</code>, converting Cartesian-format coordinates into screen format.</p>
<p><code>scaleBox</code> also supplies data attributes describing the source and destination spaces: i.e. minimum, maximum and range values for each axis. <code>xMin</code>, <code>xMax</code>, <code>yMin</code>, <code>yMax</code>, <code>height</code> and <code>width</code> of the source and destination boxes are accessible as properties of  <code>@src</code> and <code>@dest</code>, respectively.  Each of these objects also has the convenience property <code>coordText</code>, a string equal to <code>xMin yMin xMax yMax</code> of the corresponding space.  This is the same format used to assign values to <code>viewBox</code> and certain other attributes.</p>
<p>Before we get into the implementation of <code>scaleBox</code>, let&#39;s see what it looks like in use on our existing point-plotting template:</p>
<pre><code class="lang-xml"><span class="support tag"><span class="support tag">&lt;?</span><span class="support tag-name">xml</span></span> <span class="support attribute">version</span>=&quot;1.0&quot;<span class="support tag close">?&gt;</span>

<span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">svg</span></span> <span class="support attribute">width</span>=&quot;450&quot; <span class="support attribute">height</span>=&quot;500&quot; <span class="support attribute">version</span>=&quot;1.1&quot;
    <span class="support attribute">xmlns:svg</span>=&quot;http://www.w3.org/2000/svg&quot;
    <span class="support attribute">xmlns</span>=&quot;http://www.w3.org/2000/svg&quot;
    <span class="support attribute">xmlns:xlink</span>=&quot;http://www.w3.org/1999/xlink&quot;<span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">defs</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">symbol</span></span> <span class="support attribute">id</span>=&quot;one-point&quot; <span class="support attribute">viewBox</span>=&quot;0 0 20 20&quot;<span class="support tag close">&gt;</span>
            <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">circle</span></span> <span class="support attribute">cx</span>=&quot;10&quot; <span class="support attribute">cy</span>=&quot;10&quot; <span class="support attribute">r</span>=&quot;5&quot; <span class="support attribute">stroke-width</span>=&quot;1&quot; 
                <span class="support attribute">stroke</span>=&quot;#333333&quot; <span class="support attribute">fill</span>=&quot;#00ff00&quot; <span class="support tag close">/&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">symbol</span></span><span class="support tag close">&gt;</span>

{{#scaleBox xAxis.min yAxis.min xAxis.max yAxis.max 0 0 100 100}}
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">symbol</span></span> <span class="support attribute">id</span>=&quot;plotted-points&quot; <span class="support attribute">viewBox</span>=&quot;{{@dest.coordText}}&quot;<span class="support tag close">&gt;</span>
            <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">rect</span></span> <span class="support attribute">x</span>=&quot;{{@dest.xMin}}&quot; <span class="support attribute">y</span>=&quot;{{@dest.yMin}}&quot;
                <span class="support attribute">width</span>=&quot;{{@dest.width}}&quot; <span class="support attribute">height</span>=&quot;{{@dest.width}}&quot;
                <span class="support attribute">fill</span>=&quot;none&quot; <span class="support attribute">stroke</span>=&quot;#333333&quot; <span class="support attribute">stroke-width</span>=&quot;1&quot;<span class="support tag close">/&gt;</span>
            {{#each points}}
                <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">use</span></span> <span class="support attribute">xlink:href</span>=&quot;#one-point&quot;
                    <span class="support attribute">x</span>=&quot;{{apply @xScale x}}&quot;
                    <span class="support attribute">y</span>=&quot;{{apply @yScaleInvert y}}&quot;
                    <span class="support attribute">height</span>=&quot;5&quot; <span class="support attribute">width</span>=&quot;5&quot;<span class="support tag close">/&gt;</span>
            {{/each}}
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">symbol</span></span><span class="support tag close">&gt;</span>
{{/scaleBox}}

    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">defs</span></span><span class="support tag close">&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">rect</span></span> <span class="support attribute">x</span>=&quot;0&quot; <span class="support attribute">y</span>=&quot;0&quot; <span class="support attribute">width</span>=&quot;450&quot; <span class="support attribute">height</span>=&quot;500&quot;
            <span class="support attribute">stroke</span>=&quot;#333333&quot; <span class="support attribute">stroke-width</span>=&quot;2&quot; <span class="support attribute">fill</span>=&quot;none&quot;<span class="support tag close">/&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">text</span></span> <span class="support attribute">x</span>=&quot;225&quot; <span class="support attribute">y</span>=&quot;40&quot; <span class="support attribute">font-size</span>=&quot;36px&quot;
            <span class="support attribute">text-anchor</span>=&quot;middle&quot;<span class="support tag close">&gt;</span>Plotted Points<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">text</span></span><span class="support tag close">&gt;</span>
        <span class="support tag"><span class="support tag">&lt;</span><span class="support tag-name">use</span></span> <span class="support attribute">xlink:href</span>=&quot;#plotted-points&quot; <span class="support attribute">x</span>=&quot;25&quot; <span class="support attribute">y</span>=&quot;75&quot;
            <span class="support attribute">width</span>=&quot;400&quot; <span class="support attribute">height</span>=&quot;400&quot;<span class="support tag close">/&gt;</span>
    <span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">g</span></span><span class="support tag close">&gt;</span>
<span class="support tag"><span class="support tag">&lt;</span><span class="support tag special">/</span><span class="support tag-name">svg</span></span><span class="support tag close">&gt;</span></code></pre>
<p>Using the same set of point data, the template yields this image:</p>
<div class="block-diagram block-diagram-pic fig"><section class="block-diagram-title"><h5>circles3_scaleBox_circlePoints2</h5></section> <a data-lightbox="img/fig/circles3_scaleBox_circlePoints2.svg" href="img/fig/circles3_scaleBox_circlePoints2.svg" title="The `scaleBox` helper lets us unevenly scale coordinate axes without distorting point representations."><img class="block-fig-image" src="img/fig/circles3_scaleBox_circlePoints2.svg"></a> <section class="block-diagram-caption"><p>The `scaleBox` helper lets us unevenly scale coordinate axes without distorting point representations.</p></section></div>
<pre><code class="lang-javascript">
Handlebars.<span class="function call">registerHelper</span>(&quot;scaleBox&quot;, <span class="keyword">function</span>(xMin1, yMin1, xMax1, yMax1, xMin2, yMin2, xMax2, yMax2, options) {

  <span class="keyword">var</span> data <span class="keyword operator">=</span> Handlebars.<span class="function call">createFrame</span>(options.data <span class="keyword operator">|</span><span class="keyword operator">|</span> {});


  <span class="keyword">var</span> src <span class="keyword operator">=</span> {
    xMin: xMin1,
    xMax: xMax1,
    yMin: yMin1,
    yMax: yMax1,
    width: xMax1 <span class="keyword operator">-</span> xMin1,
    height: yMax1 <span class="keyword operator">-</span> yMin1,

    <span class="comment">// leading &quot;&quot; ensures `xMin1` is coerced into string</span>
    coordText: &quot;&quot; <span class="keyword operator">+</span> xMin1 <span class="keyword operator">+</span> &quot; &quot; <span class="keyword operator">+</span> yMin1 <span class="keyword operator">+</span> &quot; &quot; <span class="keyword operator">+</span> xMax1 <span class="keyword operator">+</span> &quot; &quot; <span class="keyword operator">+</span> yMax1

  };

  <span class="keyword">var</span> dest <span class="keyword operator">=</span> {
    xMin: xMin2,
    xMax: xMax2,
    yMin: yMin2,
    yMax: yMax2,
    width: xMax2 <span class="keyword operator">-</span> xMin2,
    height: yMax2 <span class="keyword operator">-</span> yMin2,
    coordText: &quot;&quot; <span class="keyword operator">+</span> xMin2 <span class="keyword operator">+</span> &quot; &quot; <span class="keyword operator">+</span> yMin2 <span class="keyword operator">+</span> &quot; &quot; <span class="keyword operator">+</span> xMax2 <span class="keyword operator">+</span> &quot; &quot; <span class="keyword operator">+</span> yMax2
  };

  <span class="keyword">var</span> xRatio <span class="keyword operator">=</span> dest.width / src.width;
  <span class="keyword">var</span> yRatio <span class="keyword operator">=</span> dest.height / src.height;


  <span class="comment">// map x-axis of `src`-space</span>
  <span class="comment">// coordinates onto `dest`-space x-axis.</span>
  <span class="storage">var</span> <span class="entity function">xScale</span> <span class="keyword operator">=</span> <span class="keyword">function</span>(x1Val) {
    <span class="keyword">var</span> x1Delta, x2Delta, x2Val;

    <span class="comment">// get the distance of `x1Val` along src </span>
    <span class="comment">// X axis in absolute units</span>
    x1Delta <span class="keyword operator">=</span> x1Val <span class="keyword operator">-</span> src.xMin;

    <span class="comment">// scale distance by xRatio to get unit</span>
    <span class="comment">// distance along dest X axis</span>
    x2Delta <span class="keyword operator">=</span> x1Delta <span class="keyword operator">*</span> xRatio;

    <span class="comment">// offset result by xMin of dest space</span>
    x2Val <span class="keyword operator">=</span> x2Delta <span class="keyword operator">+</span> dest.xMin;
    <span class="keyword">return</span> x2Val;
  };


  <span class="comment">// map y-axis of `src`-space</span>
  <span class="comment">// coordinates onto `dest`-space y-axis.</span>
  <span class="storage">var</span> <span class="entity function">yScale</span> <span class="keyword operator">=</span> <span class="keyword">function</span>(y1Val) {
    <span class="keyword">var</span> y1Delta, y2Delta, y2Val;


    <span class="comment">// get the distance of `y1Val` along src </span>
    <span class="comment">// Y axis in absolute units</span>
    y1Delta <span class="keyword operator">=</span> y1Val <span class="keyword operator">-</span> yMin1;

    <span class="comment">// scale distance by yRatio to get unit</span>
    <span class="comment">// distance along dest Y axis    </span>
    y2Delta <span class="keyword operator">=</span> y1Delta <span class="keyword operator">*</span> yRatio;

    <span class="comment">// offset result by yMin of dest space.</span>
    y2Val <span class="keyword operator">=</span> y2Delta <span class="keyword operator">+</span> yMin2;
    <span class="keyword">return</span> y2Val;
  };

  <span class="comment">// map y-axis of `src`-space</span>
  <span class="comment">// coordinates onto `dest`-space y-axis,</span>
  <span class="comment">// then invert to Cartesian form</span>
  <span class="storage">var</span> <span class="entity function">yScaleInvert</span> <span class="keyword operator">=</span> <span class="keyword">function</span>(y1Val) {
    <span class="keyword">var</span> inverted, y2Val;

    <span class="comment">// get y value scaled to dest axis</span>
    y2Val <span class="keyword operator">=</span> <span class="function call">yScale</span>(y1Val);

    <span class="comment">// invert y value by subtracting</span>
    <span class="comment">// from dest.yMax</span>
    inverted <span class="keyword operator">=</span> yMax2 <span class="keyword operator">-</span> y2Val;
    <span class="keyword">return</span> inverted;
  };

  data.xScale <span class="keyword operator">=</span> xScale;

  data.yScale <span class="keyword operator">=</span> yScale;

  data.yScaleInvert <span class="keyword operator">=</span> yScaleInvert;

  data.src <span class="keyword operator">=</span> src;

  data.dest <span class="keyword operator">=</span> dest;

  <span class="keyword">var</span> rendered <span class="keyword operator">=</span> options.<span class="function call">fn</span>(<span class="keyword">this</span>, {data: data});
  <span class="keyword">return</span> rendered;
});</code></pre>
<div id="article_biblio"></div></div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <!--
  <div id="name-sec"><span class="scivey-span"><span class="base-sep">
        <h3 class="base-page-scivey">|</h3></span>
      <h4 class="base-page-scivey">scott ivey</h4></span></div>
  -->
</html>